<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · NearestNeighborModels.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">NearestNeighborModels.jl</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Installation-1"><span>Installation</span></a></li><li class="toplevel"><a class="tocitem" href="#Usage-1"><span>Usage</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/alan-turing-institute/NearestNeighborModels.jl/blob/master/docs/src/index.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="NearestNeighborModels-Docs-1"><a class="docs-heading-anchor" href="#NearestNeighborModels-Docs-1">NearestNeighborModels - Docs</a><a class="docs-heading-anchor-permalink" href="#NearestNeighborModels-Docs-1" title="Permalink"></a></h1><p>NearestNeighborModels is a julia package providing implemtation of various  k-nearest-neighbor classifiers and regressors models for use with  <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/">MLJ</a> machine learning  framework. It also provides users with an array of weighting kernels to choose  from for prediction.</p><p>NearestNeighborModels builds on Kristoffer Carlsson&#39;s  <a href="https://github.com/KristofferC/NearestNeighbors.jl">NearestNeighbors</a> package(for  performing efficient nearest neighbor searches) and earlier contributions from Thibaut  Lienart originally residing in  <a href="https://github.com/alan-turing-institute/MLJModels.jl/blob/98618d7be53f72054de284fa1796c5292d9071bb/src/NearestNeighbors.jl#L1">MLJModels.jl</a>.</p><h1 id="Installation-1"><a class="docs-heading-anchor" href="#Installation-1">Installation</a><a class="docs-heading-anchor-permalink" href="#Installation-1" title="Permalink"></a></h1><p>On a Julia&gt;=1.0 NearestNeighborModels can be added via Pkg as shown below.</p><pre><code class="language-julia">using Pkg
Pkg.add(&quot;NearestNeighborModels&quot;) </code></pre><h1 id="Usage-1"><a class="docs-heading-anchor" href="#Usage-1">Usage</a><a class="docs-heading-anchor-permalink" href="#Usage-1" title="Permalink"></a></h1><p>To use any model implemented in this package, the model must first be wrapped in an MLJ  machine alongside the required data. Users also get additional features from MLJ including  performance evaluation, hyper-parameter tuning, stacking etc. The following example shows how to train a <code>KNNClassifier</code> on the crabs dataset.</p><pre><code class="language-julia">using NearestNeighborModels, MLJ
X, y = @load_crabs; # loads the crabs dataset from MLJ
train_inds, test_inds = partition(1:nrows(X), 0.7, shuffle=false);
knnc = KNNClassifier(weights = Inverse()) # KNNClassifier instantiation
knnc_mach = machine(knnc, X, y) # wrap model and required data in an MLJ machine
fit!(knnc_mach, rows=train_inds) # train machine on a subset of the wrapped data `X`</code></pre><p><code>UnivariateFinite</code> predictions can be obtained from the trained machine as shown below</p><pre><code class="language-julia-repl">julia&gt; predict(knnc_mach, rows=test_inds)
60-element MLJBase.UnivariateFiniteVector{Multiclass{2}, String, UInt32, Float64}:
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;0.315, O=&gt;0.685)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 ⋮
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;0.613, O=&gt;0.387)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;0.83, O=&gt;0.17)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;0.361, O=&gt;0.639)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;0.824, O=&gt;0.176)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)
 UnivariateFinite{ScientificTypes.Multiclass{2}}(B=&gt;1.0, O=&gt;0.0)</code></pre><p>Alternatively categorical predictions may be obtained using <code>predict_mode</code> as shown below.</p><pre><code class="language-julia-repl">julia&gt; predict_mode(knnc_mach, rows=test_inds)
60-element CategoricalArrays.CategoricalArray{String,1,UInt32}:
 &quot;O&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 ⋮
 &quot;B&quot;
 &quot;B&quot;
 &quot;O&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
 &quot;B&quot;
</code></pre><p>Users who need to implement their weighting kernel may do so by wrapping the kernel function in a <code>UserDefinedKernel</code>. The following code shows how to define a <code>UserDefinedKernel</code> that assigns weights in such a way that the closest neighbor in each row of <code>dists</code> is assigned a weight of <code>2</code> while other neighbors in the same row are assigned equal weights of <code>1</code>.</p><pre><code class="language-julia"># First we define the kernel function
function custom_kernel(dists::AbstractMatrix)
    # eltype of weights must be `&lt;:AbstractFloat`
    weights = similar(Array{Float16}, size(dists))
    weights[:, 1] .= 2.0
    weights[:, 2:end] .= 1.0
    return weights
end

# Then we wrap it in a `UserDefinedKernel`
# `sort = true` because our `custom_kernel` function relies on `dists` being sorted in 
# ascending order.
weighting_kernel = UserDefinedKernel(func=custom_kernel, sort=true)</code></pre><p>We will now train a <code>MultitargetKNNRegressor</code> that makes use of our simple custom-defined  <code>weighting_kernel</code> for prediction.</p><pre><code class="language-julia">using NearestNeighborModels, MLJ
using StableRNGs #for reproducibility of this example

n = 50
p = 5
l = 2
rng = StableRNG(100)
# `table` converts an `AbstractMatrix` into a `Tables.jl` compactible table
X = table(randn(rng, (n, p))) # feature table
Y = table(randn(rng, (n, l))) # target table

train_inds, test_inds = partition(1:nrows(X), 0.8, shuffle=false);
multi_knnr = MultitargetKNNRegressor(weights=weighting_kernel)
multi_knnr_mach = machine(multi_knnr, X, Y) #wrap model and required data in an MLJ machine
fit!(multi_knnr_mach, rows=train_inds) # train machine on a subset of the wrapped data `X`</code></pre><p>And of course predicting with the test-dataset gives:</p><pre><code class="language-julia-repl">julia&gt; table_predictions = predict(multi_knnr_mach, rows=test_inds)
Tables.MatrixTable{Matrix{Float64}} with 10 rows, 2 columns, and schema:
 :x1  Float64
 :x2  Float64

julia&gt; MLJ.matrix(table_predictions)
10×2 Matrix{Float64}:
  0.0867655   0.286866
  0.388722    0.11164
 -0.0572281   0.752707
 -0.0845422   0.125039
  0.308204   -0.0840635
  0.170179   -0.0136838
  0.0916878   0.168172
  0.909645   -0.788285
 -0.35767     0.158968
  0.0352492  -0.30166</code></pre><p>see <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/">MLJ docs</a> for help on additional  features such as hyper-parameter tuning, performance evaluation, stacking etc.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 20 April 2021 07:46">Tuesday 20 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
